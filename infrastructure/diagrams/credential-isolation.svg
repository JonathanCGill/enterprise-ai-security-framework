<svg xmlns="http://www.w3.org/2000/svg" width="900" height="500" viewBox="0 0 900 500" font-family="Segoe UI, Roboto, sans-serif">
  <defs>
    <marker id="arr-green" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="none" stroke="#3fb950" stroke-width="1.2"/>
    </marker>
    <marker id="arr-red" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="none" stroke="#f85149" stroke-width="1.2"/>
    </marker>
    <marker id="arr-cyan" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="none" stroke="#58a6ff" stroke-width="1.2"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="900" height="500" fill="#0d1117" rx="8"/>

  <!-- Title -->
  <text x="450" y="38" text-anchor="middle" fill="#e6edf3" font-size="18" font-weight="600">Out-of-Band Credential Injection Architecture</text>
  <text x="450" y="58" text-anchor="middle" fill="#8b949e" font-size="12">SEC-01 — Credentials never enter the model context window</text>

  <!-- WRONG WAY (top) -->
  <text x="60" y="100" fill="#f85149" font-size="14" font-weight="600">✗ Incorrect: Credentials in Context</text>

  <!-- Agent box -->
  <rect x="60" y="115" width="160" height="55" rx="6" fill="#161b22" stroke="#f85149" stroke-width="1.5"/>
  <text x="140" y="140" text-anchor="middle" fill="#e6edf3" font-size="12" font-weight="500">Agent / Model</text>
  <text x="140" y="156" text-anchor="middle" fill="#f85149" font-size="10">Context contains API key</text>

  <!-- Direct arrow to tool -->
  <line x1="220" y1="142" x2="318" y2="142" stroke="#f85149" stroke-width="1.5" marker-end="url(#arr-red)" stroke-dasharray="5,3"/>
  <text x="270" y="134" text-anchor="middle" fill="#f85149" font-size="10">key=sk-xxx...</text>

  <!-- Tool box -->
  <rect x="320" y="115" width="140" height="55" rx="6" fill="#161b22" stroke="#f85149" stroke-width="1.5"/>
  <text x="390" y="140" text-anchor="middle" fill="#e6edf3" font-size="12" font-weight="500">External Tool / API</text>
  <text x="390" y="156" text-anchor="middle" fill="#f85149" font-size="10">Credential exposed</text>

  <!-- Attack arrow -->
  <rect x="520" y="115" width="160" height="55" rx="6" fill="#2d1215" stroke="#f85149" stroke-width="1.5"/>
  <text x="600" y="140" text-anchor="middle" fill="#f85149" font-size="12" font-weight="500">Prompt Injection</text>
  <text x="600" y="156" text-anchor="middle" fill="#f85149" font-size="10">Can extract credentials</text>

  <line x1="140" y1="115" x2="520" y2="130" stroke="#f85149" stroke-width="1" stroke-dasharray="3,3" opacity="0.5"/>

  <!-- RIGHT WAY (bottom) -->
  <text x="60" y="220" fill="#3fb950" font-size="14" font-weight="600">✓ Correct: Out-of-Band Injection via Gateway</text>

  <!-- Step labels -->
  <!-- Agent -->
  <rect x="60" y="245" width="160" height="55" rx="6" fill="#161b22" stroke="#3fb950" stroke-width="1.5"/>
  <text x="140" y="270" text-anchor="middle" fill="#e6edf3" font-size="12" font-weight="500">Agent / Model</text>
  <text x="140" y="286" text-anchor="middle" fill="#3fb950" font-size="10">No credentials in context</text>

  <!-- Step 1 arrow -->
  <line x1="220" y1="272" x2="298" y2="272" stroke="#58a6ff" stroke-width="1.5" marker-end="url(#arr-cyan)"/>
  <rect x="233" y="255" width="16" height="16" rx="8" fill="#58a6ff"/>
  <text x="241" y="267" text-anchor="middle" fill="#0d1117" font-size="10" font-weight="700">1</text>

  <!-- Gateway -->
  <rect x="300" y="235" width="180" height="75" rx="6" fill="#122117" stroke="#3fb950" stroke-width="2"/>
  <text x="390" y="260" text-anchor="middle" fill="#3fb950" font-size="13" font-weight="600">Authorization Gateway</text>
  <text x="390" y="278" text-anchor="middle" fill="#8b949e" font-size="10">Validates manifest</text>
  <text x="390" y="293" text-anchor="middle" fill="#8b949e" font-size="10">Injects credential out-of-band</text>

  <!-- Step 2 arrow: gateway to vault -->
  <line x1="390" y1="310" x2="390" y2="358" stroke="#58a6ff" stroke-width="1.5" marker-end="url(#arr-cyan)"/>
  <rect x="382" y="322" width="16" height="16" rx="8" fill="#58a6ff"/>
  <text x="390" y="334" text-anchor="middle" fill="#0d1117" font-size="10" font-weight="700">2</text>

  <!-- Vault -->
  <rect x="310" y="360" width="160" height="55" rx="6" fill="#161b22" stroke="#d29922" stroke-width="1.5"/>
  <text x="390" y="385" text-anchor="middle" fill="#d29922" font-size="12" font-weight="500">Secrets Vault</text>
  <text x="390" y="401" text-anchor="middle" fill="#8b949e" font-size="10">SEC-03 — Centralised store</text>

  <!-- Step 3 arrow: vault returns to gateway -->
  <line x1="470" y1="387" x2="490" y2="387" stroke="#d29922" stroke-width="1" stroke-dasharray="3,3"/>
  <line x1="490" y1="387" x2="490" y2="295" stroke="#d29922" stroke-width="1" stroke-dasharray="3,3"/>
  <line x1="490" y1="295" x2="482" y2="295" stroke="#d29922" stroke-width="1" stroke-dasharray="3,3"/>
  <rect x="492" y="333" width="16" height="16" rx="8" fill="#d29922"/>
  <text x="500" y="345" text-anchor="middle" fill="#0d1117" font-size="10" font-weight="700">3</text>

  <!-- Step 4 arrow: gateway to tool -->
  <line x1="480" y1="272" x2="558" y2="272" stroke="#3fb950" stroke-width="1.5" marker-end="url(#arr-green)"/>
  <rect x="505" y="255" width="16" height="16" rx="8" fill="#3fb950"/>
  <text x="513" y="267" text-anchor="middle" fill="#0d1117" font-size="10" font-weight="700">4</text>

  <!-- Tool -->
  <rect x="560" y="245" width="150" height="55" rx="6" fill="#161b22" stroke="#3fb950" stroke-width="1.5"/>
  <text x="635" y="270" text-anchor="middle" fill="#e6edf3" font-size="12" font-weight="500">External Tool / API</text>
  <text x="635" y="286" text-anchor="middle" fill="#3fb950" font-size="10">Authenticated request</text>

  <!-- Step descriptions -->
  <rect x="560" y="340" width="300" height="120" rx="6" fill="#161b22" stroke="#30363d" stroke-width="1"/>
  <text x="580" y="362" fill="#58a6ff" font-size="11" font-weight="600">Flow:</text>
  <text x="580" y="380" fill="#8b949e" font-size="11">1  Agent requests tool call (no credentials)</text>
  <text x="580" y="398" fill="#8b949e" font-size="11">2  Gateway retrieves credential from vault</text>
  <text x="580" y="416" fill="#8b949e" font-size="11">3  Vault returns scoped, short-lived token</text>
  <text x="580" y="434" fill="#8b949e" font-size="11">4  Gateway adds auth header, forwards to tool</text>

  <!-- Blocked path annotation -->
  <line x1="140" y1="300" x2="560" y2="300" stroke="#f85149" stroke-width="1" stroke-dasharray="3,3" opacity="0.3"/>
  <text x="350" y="318" text-anchor="middle" fill="#f85149" font-size="10" opacity="0.6">No direct path — agent cannot reach tools</text>
</svg>
