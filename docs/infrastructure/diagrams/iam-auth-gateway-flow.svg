<svg xmlns="http://www.w3.org/2000/svg" width="780" height="340" viewBox="0 0 780 340" font-family="'Segoe UI', 'Helvetica Neue', Arial, sans-serif">
  <defs>
    <filter id="shadow" x="-2%" y="-2%" width="104%" height="104%">
      <feDropShadow dx="1" dy="1" stdDeviation="2" flood-color="#000" flood-opacity="0.2"/>
    </filter>
    <marker id="arrowG" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#4ecca3"/>
    </marker>
    <marker id="arrowO" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#f0a500"/>
    </marker>
    <marker id="arrowR" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#e94560"/>
    </marker>
  </defs>

  <rect width="780" height="340" rx="8" fill="#0d1117"/>

  <!-- Agent Decision -->
  <rect x="30" y="30" width="240" height="45" rx="6" fill="#1a3a5c" stroke="#4ecca3" stroke-width="1.5" filter="url(#shadow)"/>
  <text x="150" y="50" text-anchor="middle" fill="#e6e6e6" font-size="12" font-weight="600">ğŸ¤– Agent Decision</text>
  <text x="150" y="66" text-anchor="middle" fill="#8b949e" font-size="9">"I need to query the customer database"</text>

  <!-- Arrow down -->
  <line x1="150" y1="75" x2="150" y2="100" stroke="#4ecca3" stroke-width="1.5" marker-end="url(#arrowG)"/>

  <!-- Authorization Gateway -->
  <rect x="60" y="105" width="180" height="45" rx="6" fill="#2d1b1b" stroke="#e94560" stroke-width="2" filter="url(#shadow)"/>
  <text x="150" y="132" text-anchor="middle" fill="#e94560" font-size="13" font-weight="700">ğŸ”’ Authorization Gateway</text>

  <!-- Decision branches -->
  <!-- Branch 1: Tool permitted? -->
  <line x1="240" y1="120" x2="320" y2="120" stroke="#8b949e" stroke-width="1.5"/>
  <rect x="325" y="30" width="250" height="42" rx="20" fill="#0d1117" stroke="#8b949e" stroke-width="1.5"/>
  <text x="450" y="55" text-anchor="middle" fill="#e6e6e6" font-size="11">Tool in declared permission set?</text>
  <line x1="325" y1="51" x2="240" y2="90" stroke="#8b949e" stroke-width="1" stroke-dasharray="3 2"/>

  <!-- Yes path -->
  <line x1="575" y1="51" x2="625" y2="51" stroke="#4ecca3" stroke-width="1.5" marker-end="url(#arrowG)"/>
  <text x="600" y="44" fill="#4ecca3" font-size="9" font-weight="600">Yes</text>

  <!-- No path -->
  <rect x="630" y="33" width="120" height="36" rx="5" fill="#3a1a1a" stroke="#e94560" stroke-width="1.5"/>
  <text x="690" y="56" text-anchor="middle" fill="#e94560" font-size="11" font-weight="600">ğŸš« DENY + LOG</text>

  <!-- Branch 2: Parameters within constraints? -->
  <rect x="325" y="100" width="250" height="42" rx="20" fill="#0d1117" stroke="#8b949e" stroke-width="1.5"/>
  <text x="450" y="125" text-anchor="middle" fill="#e6e6e6" font-size="11">Parameters within constraints?</text>

  <line x1="575" y1="121" x2="625" y2="121" stroke="#4ecca3" stroke-width="1.5" marker-end="url(#arrowG)"/>
  <text x="600" y="114" fill="#4ecca3" font-size="9" font-weight="600">Yes</text>

  <rect x="630" y="103" width="120" height="36" rx="5" fill="#3a1a1a" stroke="#e94560" stroke-width="1.5"/>
  <text x="690" y="126" text-anchor="middle" fill="#e94560" font-size="11" font-weight="600">ğŸš« DENY + LOG</text>

  <!-- Branch 3: Reversible? -->
  <rect x="325" y="170" width="250" height="42" rx="20" fill="#0d1117" stroke="#8b949e" stroke-width="1.5"/>
  <text x="450" y="195" text-anchor="middle" fill="#e6e6e6" font-size="11">Is this action reversible?</text>

  <line x1="240" y1="150" x2="320" y2="191" stroke="#8b949e" stroke-width="1" stroke-dasharray="3 2"/>

  <!-- Yes: Execute -->
  <line x1="575" y1="183" x2="625" y2="183" stroke="#4ecca3" stroke-width="1.5" marker-end="url(#arrowG)"/>
  <text x="600" y="176" fill="#4ecca3" font-size="9" font-weight="600">Yes</text>

  <rect x="630" y="168" width="120" height="36" rx="5" fill="#2d4a1e" stroke="#4ecca3" stroke-width="1.5"/>
  <text x="690" y="191" text-anchor="middle" fill="#4ecca3" font-size="11" font-weight="600">âœ… EXECUTE</text>

  <!-- No: Route to human -->
  <line x1="450" y1="212" x2="450" y2="242" stroke="#f0a500" stroke-width="1.5" marker-end="url(#arrowO)"/>
  <text x="465" y="232" fill="#f0a500" font-size="9" font-weight="600">No</text>

  <rect x="360" y="248" width="185" height="42" rx="5" fill="#2d2a00" stroke="#f0a500" stroke-width="1.5" filter="url(#shadow)"/>
  <text x="452" y="268" text-anchor="middle" fill="#f0a500" font-size="11" font-weight="600">â¸ï¸ Route to IAM-05</text>
  <text x="452" y="283" text-anchor="middle" fill="#8b949e" font-size="9">Human approval required</text>

  <!-- Log everything -->
  <rect x="30" y="248" width="200" height="42" rx="5" fill="#1e1e3f" stroke="#8b949e" stroke-width="1"/>
  <text x="130" y="268" text-anchor="middle" fill="#8b949e" font-size="11" font-weight="600">ğŸ“œ Log decision + outcome</text>
  <text x="130" y="283" text-anchor="middle" fill="#8b949e" font-size="9">â†’ Logging pipeline (LOG-04)</text>

  <!-- Connecting line from gateway to log -->
  <line x1="150" y1="150" x2="150" y2="243" stroke="#8b949e" stroke-width="1" stroke-dasharray="3 2"/>

  <!-- Footer -->
  <text x="390" y="330" text-anchor="middle" fill="#484f58" font-size="9">IAM-04 Â· The gateway is infrastructure, not a prompt instruction â€” the agent does not enforce its own permissions</text>
</svg>
