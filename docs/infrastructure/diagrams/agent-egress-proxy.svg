<svg xmlns="http://www.w3.org/2000/svg" width="880" height="450" viewBox="0 0 880 450" font-family="'Segoe UI', 'Helvetica Neue', Arial, sans-serif">
  <defs>
    <filter id="shadow" x="-2%" y="-2%" width="104%" height="104%">
      <feDropShadow dx="1" dy="1" stdDeviation="2" flood-color="#000" flood-opacity="0.2"/>
    </filter>
    <marker id="arrowG" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#4ecca3"/>
    </marker>
    <marker id="arrowO" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#f0a500"/>
    </marker>
    <marker id="arrowR" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#e94560"/>
    </marker>
    <marker id="arrowW" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#8b949e"/>
    </marker>
  </defs>

  <rect width="880" height="450" rx="8" fill="#0d1117"/>

  <!-- Title -->
  <text x="440" y="30" text-anchor="middle" fill="#e6e6e6" font-size="18" font-weight="700">Agent Egress Controls â€” NET-04</text>
  <text x="440" y="50" text-anchor="middle" fill="#8b949e" font-size="11">All agent-initiated outbound traffic mediated by egress proxy</text>

  <!-- Zone 2: Runtime -->
  <rect x="30" y="70" width="250" height="180" rx="6" fill="#0f3460" stroke="#f0a500" stroke-width="1.5" filter="url(#shadow)"/>
  <rect x="30" y="70" width="250" height="20" rx="6" fill="#f0a500"/>
  <rect x="30" y="82" width="250" height="8" fill="#0f3460"/>
  <text x="155" y="85" text-anchor="middle" fill="#0d1117" font-size="10" font-weight="700">ZONE 2 Â· RUNTIME</text>

  <!-- Agent -->
  <rect x="50" y="100" width="210" height="55" rx="5" fill="#1a3a5c" stroke="#4ecca3" stroke-width="1.5"/>
  <text x="155" y="122" text-anchor="middle" fill="#4ecca3" font-size="12" font-weight="600">ğŸ¤– AI Agent</text>
  <text x="155" y="140" text-anchor="middle" fill="#8b949e" font-size="9">Decides to invoke tool at runtime</text>

  <!-- Agent's decision -->
  <rect x="50" y="165" width="210" height="35" rx="4" fill="#1e1e3f" stroke="#c084fc" stroke-width="0.5"/>
  <text x="155" y="180" text-anchor="middle" fill="#c084fc" font-size="9">"I need to call the payments API"</text>
  <text x="155" y="193" text-anchor="middle" fill="#8b949e" font-size="8">Destination determined by model at runtime</text>

  <!-- Arrow to egress proxy -->
  <line x1="155" y1="210" x2="155" y2="240" stroke="#f0a500" stroke-width="1"/>
  <text x="165" y="230" fill="#f0a500" font-size="8">All egress</text>

  <!-- Egress Proxy -->
  <rect x="30" y="270" width="250" height="155" rx="6" fill="#2d2a00" stroke="#f0a500" stroke-width="2" filter="url(#shadow)"/>
  <text x="155" y="295" text-anchor="middle" fill="#f0a500" font-size="13" font-weight="700">ğŸŒ Egress Proxy</text>
  <line x1="45" y1="302" x2="265" y2="302" stroke="#f0a500" stroke-width="0.5" opacity="0.3"/>

  <text x="55" y="320" fill="#e6e6e6" font-size="10">1. Destination allowlist check</text>
  <text x="55" y="338" fill="#e6e6e6" font-size="10">2. Protocol restriction (HTTPS only)</text>
  <text x="55" y="356" fill="#e6e6e6" font-size="10">3. Payload inspection (PII, creds)</text>
  <text x="55" y="374" fill="#e6e6e6" font-size="10">4. Per-destination rate limiting</text>
  <text x="55" y="392" fill="#e6e6e6" font-size="10">5. Full request/response logging</text>
  <text x="55" y="412" fill="#8b949e" font-size="8">Enforces IAM-04 at network layer</text>

  <!-- Arrow from proxy to arrow down to logging -->
  <line x1="155" y1="245" x2="155" y2="265" stroke="#f0a500" stroke-width="2" marker-end="url(#arrowO)"/>

  <!-- ===== OUTBOUND DESTINATIONS ===== -->
  <!-- Allowed: Payments API -->
  <rect x="350" y="270" width="200" height="48" rx="5" fill="#2d4a1e" stroke="#4ecca3" stroke-width="1.5" filter="url(#shadow)"/>
  <text x="450" y="290" text-anchor="middle" fill="#4ecca3" font-size="11" font-weight="600">âœ… payments.internal/api</text>
  <text x="450" y="307" text-anchor="middle" fill="#8b949e" font-size="9">On allowlist Â· HTTPS Â· Rate limited</text>

  <line x1="280" y1="310" x2="345" y2="294" stroke="#4ecca3" stroke-width="1.5" marker-end="url(#arrowG)"/>

  <!-- Allowed: CRM API -->
  <rect x="350" y="330" width="200" height="48" rx="5" fill="#2d4a1e" stroke="#4ecca3" stroke-width="1.5" filter="url(#shadow)"/>
  <text x="450" y="350" text-anchor="middle" fill="#4ecca3" font-size="11" font-weight="600">âœ… crm.internal/query</text>
  <text x="450" y="367" text-anchor="middle" fill="#8b949e" font-size="9">On allowlist Â· HTTPS Â· Read only</text>

  <line x1="280" y1="345" x2="345" y2="354" stroke="#4ecca3" stroke-width="1.5" marker-end="url(#arrowG)"/>

  <!-- Blocked: Attacker endpoint -->
  <rect x="620" y="270" width="230" height="48" rx="5" fill="#3a1a1a" stroke="#e94560" stroke-width="1.5" filter="url(#shadow)"/>
  <text x="735" y="290" text-anchor="middle" fill="#e94560" font-size="11" font-weight="600">ğŸš« evil.attacker.com</text>
  <text x="735" y="307" text-anchor="middle" fill="#e94560" font-size="9">Not on allowlist â†’ BLOCKED + ALERT</text>

  <line x1="550" y1="294" x2="615" y2="294" stroke="#e94560" stroke-width="1.5" stroke-dasharray="5 3" marker-end="url(#arrowR)"/>

  <!-- Blocked: Internal lateral -->
  <rect x="620" y="330" width="230" height="48" rx="5" fill="#3a1a1a" stroke="#e94560" stroke-width="1.5" filter="url(#shadow)"/>
  <text x="735" y="350" text-anchor="middle" fill="#e94560" font-size="11" font-weight="600">ğŸš« 10.0.1.50:5432</text>
  <text x="735" y="367" text-anchor="middle" fill="#e94560" font-size="9">Internal network â†’ BLOCKED + ALERT</text>

  <line x1="550" y1="354" x2="615" y2="354" stroke="#e94560" stroke-width="1.5" stroke-dasharray="5 3" marker-end="url(#arrowR)"/>

  <!-- Blocked: DNS tunnel -->
  <rect x="620" y="390" width="230" height="48" rx="5" fill="#3a1a1a" stroke="#e94560" stroke-width="1.5" filter="url(#shadow)"/>
  <text x="735" y="410" text-anchor="middle" fill="#e94560" font-size="11" font-weight="600">ğŸš« UDP/53 exfil.tunnel.io</text>
  <text x="735" y="427" text-anchor="middle" fill="#e94560" font-size="9">Non-HTTPS protocol â†’ BLOCKED + ALERT</text>

  <line x1="550" y1="414" x2="615" y2="414" stroke="#e94560" stroke-width="1.5" stroke-dasharray="5 3" marker-end="url(#arrowR)"/>

  <!-- What this prevents box -->
  <rect x="350" y="80" width="500" height="165" rx="6" fill="#1e1e3f" stroke="#533483" stroke-width="1" filter="url(#shadow)"/>
  <text x="600" y="102" text-anchor="middle" fill="#c084fc" font-size="12" font-weight="700">What Egress Controls Prevent</text>
  <line x1="365" y1="108" x2="835" y2="108" stroke="#533483" stroke-width="0.5" opacity="0.3"/>

  <text x="370" y="128" fill="#e6e6e6" font-size="10">ğŸ›¡ï¸ Agent manipulated via prompt injection cannot exfiltrate to</text>
  <text x="385" y="143" fill="#8b949e" font-size="10">attacker-controlled endpoints (not on allowlist)</text>

  <text x="370" y="163" fill="#e6e6e6" font-size="10">ğŸ›¡ï¸ Agent cannot be used as a proxy to attack internal systems</text>
  <text x="385" y="178" fill="#8b949e" font-size="10">(internal networks not on egress allowlist)</text>

  <text x="370" y="198" fill="#e6e6e6" font-size="10">ğŸ›¡ï¸ Agent cannot establish persistent C2 outbound connections</text>

  <text x="370" y="218" fill="#e6e6e6" font-size="10">ğŸ›¡ï¸ Tool endpoint probing is logged, rate-limited, and alertable</text>

  <!-- Footer -->
  <text x="440" y="445" text-anchor="middle" fill="#484f58" font-size="9">AI Runtime Behaviour Security â€” Technical Controls Â· Agent Egress Â· github.com/JonathanCGill</text>
</svg>
