<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 500">
  <defs>
    <linearGradient id="sourceGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#fef3c7"/>
      <stop offset="100%" style="stop-color:#fde68a"/>
    </linearGradient>
    <linearGradient id="streamGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#dbeafe"/>
      <stop offset="100%" style="stop-color:#bfdbfe"/>
    </linearGradient>
    <linearGradient id="processGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#d1fae5"/>
      <stop offset="100%" style="stop-color:#a7f3d0"/>
    </linearGradient>
    <linearGradient id="storeGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#e0e7ff"/>
      <stop offset="100%" style="stop-color:#c7d2fe"/>
    </linearGradient>
    <linearGradient id="mlGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#f3e8ff"/>
      <stop offset="100%" style="stop-color:#e9d5ff"/>
    </linearGradient>
    <linearGradient id="outputGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#fecaca"/>
      <stop offset="100%" style="stop-color:#fca5a5"/>
    </linearGradient>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="2" stdDeviation="2" flood-opacity="0.1"/>
    </filter>
    <marker id="arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#64748b"/>
    </marker>
    <marker id="arrowBlue" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#3b82f6"/>
    </marker>
  </defs>
  
  <!-- Background -->
  <rect width="900" height="500" fill="#f8fafc"/>
  
  <!-- Title -->
  <text x="450" y="30" text-anchor="middle" font-family="system-ui, sans-serif" font-size="18" font-weight="bold" fill="#1e293b">Alert Aggregation Pipeline</text>
  
  <!-- STAGE 1: Alert Sources -->
  <text x="85" y="65" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" font-weight="600" fill="#64748b">SOURCES</text>
  
  <g transform="translate(20, 80)">
    <rect x="0" y="0" width="130" height="45" rx="6" fill="url(#sourceGrad)" stroke="#f59e0b" stroke-width="1.5" filter="url(#shadow)"/>
    <text x="65" y="20" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" font-weight="600" fill="#92400e">Guardrails</text>
    <text x="65" y="35" text-anchor="middle" font-family="system-ui, sans-serif" font-size="8" fill="#a16207">Block events, patterns</text>
  </g>
  
  <g transform="translate(20, 135)">
    <rect x="0" y="0" width="130" height="45" rx="6" fill="url(#sourceGrad)" stroke="#f59e0b" stroke-width="1.5" filter="url(#shadow)"/>
    <text x="65" y="20" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" font-weight="600" fill="#92400e">LLM-as-Judge</text>
    <text x="65" y="35" text-anchor="middle" font-family="system-ui, sans-serif" font-size="8" fill="#a16207">Flags, scores</text>
  </g>
  
  <g transform="translate(20, 190)">
    <rect x="0" y="0" width="130" height="45" rx="6" fill="url(#sourceGrad)" stroke="#f59e0b" stroke-width="1.5" filter="url(#shadow)"/>
    <text x="65" y="20" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" font-weight="600" fill="#92400e">Formal Verify</text>
    <text x="65" y="35" text-anchor="middle" font-family="system-ui, sans-serif" font-size="8" fill="#a16207">Validation results</text>
  </g>
  
  <g transform="translate(20, 245)">
    <rect x="0" y="0" width="130" height="45" rx="6" fill="url(#sourceGrad)" stroke="#f59e0b" stroke-width="1.5" filter="url(#shadow)"/>
    <text x="65" y="20" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" font-weight="600" fill="#92400e">Knowledge Graph</text>
    <text x="65" y="35" text-anchor="middle" font-family="system-ui, sans-serif" font-size="8" fill="#a16207">Fact mismatches</text>
  </g>
  
  <g transform="translate(20, 300)">
    <rect x="0" y="0" width="130" height="45" rx="6" fill="url(#sourceGrad)" stroke="#f59e0b" stroke-width="1.5" filter="url(#shadow)"/>
    <text x="65" y="20" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" font-weight="600" fill="#92400e">Human Review</text>
    <text x="65" y="35" text-anchor="middle" font-family="system-ui, sans-serif" font-size="8" fill="#a16207">Escalation outcomes</text>
  </g>
  
  <!-- Arrows from sources to stream -->
  <g stroke="#64748b" stroke-width="1.5" fill="none">
    <path d="M 150 102 L 200 102 L 200 195 L 230 195" marker-end="url(#arrow)"/>
    <path d="M 150 157 L 190 157 L 190 195 L 230 195" marker-end="url(#arrow)"/>
    <path d="M 150 212 L 180 212 L 180 195 L 230 195" marker-end="url(#arrow)"/>
    <path d="M 150 267 L 190 267 L 190 195 L 230 195" marker-end="url(#arrow)"/>
    <path d="M 150 322 L 200 322 L 200 195 L 230 195" marker-end="url(#arrow)"/>
  </g>
  
  <!-- STAGE 2: Event Stream -->
  <text x="295" y="65" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" font-weight="600" fill="#64748b">STREAM</text>
  
  <rect x="230" y="140" width="130" height="110" rx="8" fill="url(#streamGrad)" stroke="#3b82f6" stroke-width="1.5" filter="url(#shadow)"/>
  <text x="295" y="165" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" font-weight="600" fill="#1e40af">Event Stream</text>
  <text x="295" y="185" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#3b82f6">(Kafka, Kinesis,</text>
  <text x="295" y="198" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#3b82f6">Pub/Sub)</text>
  <line x1="245" y1="210" x2="345" y2="210" stroke="#93c5fd" stroke-width="1"/>
  <text x="295" y="228" text-anchor="middle" font-family="system-ui, sans-serif" font-size="8" fill="#2563eb">‚Ä¢ Ordered events</text>
  <text x="295" y="240" text-anchor="middle" font-family="system-ui, sans-serif" font-size="8" fill="#2563eb">‚Ä¢ Replay capability</text>
  
  <!-- Arrow to aggregator -->
  <path d="M 360 195 L 410 195" stroke="#64748b" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  
  <!-- STAGE 3: Aggregator -->
  <text x="490" y="65" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" font-weight="600" fill="#64748b">PROCESS</text>
  
  <rect x="410" y="110" width="160" height="170" rx="8" fill="url(#processGrad)" stroke="#10b981" stroke-width="1.5" filter="url(#shadow)"/>
  <text x="490" y="135" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" font-weight="600" fill="#166534">Aggregator</text>
  <line x1="425" y1="145" x2="555" y2="145" stroke="#6ee7b7" stroke-width="1"/>
  
  <text x="430" y="165" font-family="system-ui, sans-serif" font-size="9" font-weight="600" fill="#047857">Sessionize</text>
  <text x="430" y="178" font-family="system-ui, sans-serif" font-size="8" fill="#059669">Group by request_id, user</text>
  
  <text x="430" y="198" font-family="system-ui, sans-serif" font-size="9" font-weight="600" fill="#047857">Correlate</text>
  <text x="430" y="211" font-family="system-ui, sans-serif" font-size="8" fill="#059669">Link alerts across layers</text>
  
  <text x="430" y="231" font-family="system-ui, sans-serif" font-size="9" font-weight="600" fill="#047857">Enrich</text>
  <text x="430" y="244" font-family="system-ui, sans-serif" font-size="8" fill="#059669">Add model version, context</text>
  
  <text x="430" y="264" font-family="system-ui, sans-serif" font-size="9" font-weight="600" fill="#047857">Compute</text>
  <text x="430" y="277" font-family="system-ui, sans-serif" font-size="8" fill="#059669">Rolling stats, baselines</text>
  
  <!-- Arrow to store -->
  <path d="M 570 195 L 620 195" stroke="#64748b" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  
  <!-- STAGE 4: Alert Store -->
  <text x="695" y="65" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" font-weight="600" fill="#64748b">STORE</text>
  
  <rect x="620" y="130" width="150" height="130" rx="8" fill="url(#storeGrad)" stroke="#6366f1" stroke-width="1.5" filter="url(#shadow)"/>
  <text x="695" y="155" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" font-weight="600" fill="#4338ca">Alert Store</text>
  <text x="695" y="172" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#6366f1">(Time-series DB)</text>
  <line x1="635" y1="182" x2="755" y2="182" stroke="#a5b4fc" stroke-width="1"/>
  <text x="695" y="200" text-anchor="middle" font-family="system-ui, sans-serif" font-size="8" fill="#4f46e5">‚Ä¢ Indexed by time</text>
  <text x="695" y="213" text-anchor="middle" font-family="system-ui, sans-serif" font-size="8" fill="#4f46e5">‚Ä¢ Fast aggregation</text>
  <text x="695" y="226" text-anchor="middle" font-family="system-ui, sans-serif" font-size="8" fill="#4f46e5">‚Ä¢ Retention policies</text>
  <text x="695" y="239" text-anchor="middle" font-family="system-ui, sans-serif" font-size="8" fill="#4f46e5">‚Ä¢ Query interface</text>
  
  <!-- Arrow down to ML -->
  <path d="M 695 260 L 695 300" stroke="#64748b" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  
  <!-- STAGE 5: ML Anomaly Detection -->
  <text x="490" y="320" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" font-weight="600" fill="#64748b">ANALYZE</text>
  
  <rect x="410" y="335" width="360" height="90" rx="8" fill="url(#mlGrad)" stroke="#a855f7" stroke-width="1.5" filter="url(#shadow)"/>
  <text x="590" y="358" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" font-weight="600" fill="#7c3aed">ML Anomaly Detection</text>
  <line x1="425" y1="368" x2="755" y2="368" stroke="#d8b4fe" stroke-width="1"/>
  
  <text x="490" y="388" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" font-weight="600" fill="#7c3aed">Baseline Models</text>
  <text x="490" y="402" text-anchor="middle" font-family="system-ui, sans-serif" font-size="8" fill="#9333ea">Historical rates, patterns, cohorts</text>
  
  <text x="690" y="388" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" font-weight="600" fill="#7c3aed">Anomaly Detection</text>
  <text x="690" y="402" text-anchor="middle" font-family="system-ui, sans-serif" font-size="8" fill="#9333ea">Z-score, clustering, outliers</text>
  
  <!-- Arrows to outputs -->
  <path d="M 490 425 L 490 450 L 150 450 L 150 465" stroke="#a855f7" stroke-width="1.5" fill="none" marker-end="url(#arrow)"/>
  <path d="M 590 425 L 590 465" stroke="#a855f7" stroke-width="1.5" fill="none" marker-end="url(#arrow)"/>
  <path d="M 690 425 L 690 450 L 830 450 L 830 465" stroke="#a855f7" stroke-width="1.5" fill="none" marker-end="url(#arrow)"/>
  
  <!-- OUTPUT: Dashboards -->
  <rect x="70" y="465" width="160" height="30" rx="6" fill="#fff" stroke="#10b981" stroke-width="1.5"/>
  <text x="150" y="485" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" font-weight="600" fill="#166534">üìä Dashboards</text>
  
  <!-- OUTPUT: Alerts -->
  <rect x="510" y="465" width="160" height="30" rx="6" fill="url(#outputGrad)" stroke="#ef4444" stroke-width="1.5"/>
  <text x="590" y="485" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" font-weight="600" fill="#dc2626">üö® Automated Alerts</text>
  
  <!-- OUTPUT: Pattern Discovery -->
  <rect x="750" y="465" width="160" height="30" rx="6" fill="#fff" stroke="#8b5cf6" stroke-width="1.5"/>
  <text x="830" y="485" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" font-weight="600" fill="#7c3aed">üîç Pattern Discovery</text>
  
  <!-- Sample Event Schema callout -->
  <rect x="230" y="280" width="160" height="95" rx="6" fill="#fff" stroke="#e2e8f0" stroke-width="1" filter="url(#shadow)"/>
  <text x="310" y="298" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" font-weight="600" fill="#475569">Event Schema</text>
  <text x="240" y="315" font-family="monospace" font-size="7" fill="#64748b">{</text>
  <text x="245" y="327" font-family="monospace" font-size="7" fill="#64748b">request_id: "abc123"</text>
  <text x="245" y="339" font-family="monospace" font-size="7" fill="#64748b">layer: "guardrail"</text>
  <text x="245" y="351" font-family="monospace" font-size="7" fill="#64748b">event_type: "block"</text>
  <text x="245" y="363" font-family="monospace" font-size="7" fill="#64748b">confidence: 0.94</text>
  <text x="240" y="375" font-family="monospace" font-size="7" fill="#64748b">}</text>
  
  <!-- Connector from event stream to schema -->
  <path d="M 295 250 L 295 265 L 310 265 L 310 280" stroke="#94a3b8" stroke-width="1" stroke-dasharray="3" fill="none"/>
</svg>
