<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 850 500">
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#475569"/>
    </marker>
    <marker id="arrow-green" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#22c55e"/>
    </marker>
  </defs>
  
  <rect width="850" height="500" fill="#f8fafc"/>
  
  <text x="425" y="28" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#1e293b" text-anchor="middle">Implementation Architecture</text>
  
  <!-- Phase labels at top -->
  <rect x="50" y="45" width="150" height="25" rx="4" fill="#f1f5f9" stroke="#94a3b8" stroke-width="1"/>
  <text x="125" y="62" font-family="Arial, sans-serif" font-size="10" fill="#475569" text-anchor="middle">Phase 1: Guardrails</text>
  
  <rect x="220" y="45" width="150" height="25" rx="4" fill="#f1f5f9" stroke="#94a3b8" stroke-width="1"/>
  <text x="295" y="62" font-family="Arial, sans-serif" font-size="10" fill="#475569" text-anchor="middle">Phase 2: Judge</text>
  
  <rect x="390" y="45" width="150" height="25" rx="4" fill="#f1f5f9" stroke="#94a3b8" stroke-width="1"/>
  <text x="465" y="62" font-family="Arial, sans-serif" font-size="10" fill="#475569" text-anchor="middle">Phase 3: HITL</text>
  
  <rect x="560" y="45" width="150" height="25" rx="4" fill="#f1f5f9" stroke="#94a3b8" stroke-width="1"/>
  <text x="635" y="62" font-family="Arial, sans-serif" font-size="10" fill="#475569" text-anchor="middle">Phase 4: Operate</text>
  
  <!-- Main flow area -->
  <rect x="50" y="85" width="750" height="200" rx="8" fill="#ffffff" stroke="#e2e8f0" stroke-width="2"/>
  <text x="75" y="105" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#64748b">RUNTIME LAYER</text>
  
  <!-- User -->
  <rect x="70" y="130" width="70" height="50" rx="6" fill="#e0e7ff" stroke="#6366f1" stroke-width="1.5"/>
  <text x="105" y="160" font-family="Arial, sans-serif" font-size="10" fill="#4338ca" text-anchor="middle">User</text>
  
  <line x1="140" y1="155" x2="175" y2="155" stroke="#475569" stroke-width="1.5" marker-end="url(#arrow)"/>
  
  <!-- Input Guardrails -->
  <rect x="180" y="120" width="100" height="70" rx="6" fill="#dcfce7" stroke="#22c55e" stroke-width="2"/>
  <text x="230" y="145" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#166534" text-anchor="middle">Input</text>
  <text x="230" y="160" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#166534" text-anchor="middle">Guardrails</text>
  <text x="230" y="180" font-family="Arial, sans-serif" font-size="8" fill="#166534" text-anchor="middle">(inline, blocks)</text>
  
  <line x1="280" y1="155" x2="315" y2="155" stroke="#475569" stroke-width="1.5" marker-end="url(#arrow)"/>
  
  <!-- Primary AI -->
  <rect x="320" y="130" width="90" height="50" rx="6" fill="#dbeafe" stroke="#3b82f6" stroke-width="1.5"/>
  <text x="365" y="152" font-family="Arial, sans-serif" font-size="10" fill="#1e40af" text-anchor="middle">Primary</text>
  <text x="365" y="167" font-family="Arial, sans-serif" font-size="10" fill="#1e40af" text-anchor="middle">AI</text>
  
  <line x1="410" y1="155" x2="445" y2="155" stroke="#475569" stroke-width="1.5" marker-end="url(#arrow)"/>
  
  <!-- Output Guardrails -->
  <rect x="450" y="120" width="100" height="70" rx="6" fill="#dcfce7" stroke="#22c55e" stroke-width="2"/>
  <text x="500" y="145" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#166534" text-anchor="middle">Output</text>
  <text x="500" y="160" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#166534" text-anchor="middle">Guardrails</text>
  <text x="500" y="180" font-family="Arial, sans-serif" font-size="8" fill="#166534" text-anchor="middle">(inline, filters)</text>
  
  <line x1="550" y1="155" x2="585" y2="155" stroke="#475569" stroke-width="1.5" marker-end="url(#arrow)"/>
  
  <!-- Response -->
  <rect x="590" y="130" width="70" height="50" rx="6" fill="#e0e7ff" stroke="#6366f1" stroke-width="1.5"/>
  <text x="625" y="160" font-family="Arial, sans-serif" font-size="10" fill="#4338ca" text-anchor="middle">Response</text>
  
  <!-- Logging -->
  <rect x="680" y="130" width="100" height="50" rx="6" fill="#f1f5f9" stroke="#94a3b8" stroke-width="1.5"/>
  <text x="730" y="152" font-family="Arial, sans-serif" font-size="10" fill="#475569" text-anchor="middle">Logging</text>
  <text x="730" y="167" font-family="Arial, sans-serif" font-size="8" fill="#64748b" text-anchor="middle">(all interactions)</text>
  
  <line x1="660" y1="155" x2="675" y2="155" stroke="#94a3b8" stroke-width="1.5" marker-end="url(#arrow)"/>
  
  <!-- Async arrow down -->
  <line x1="730" y1="180" x2="730" y2="220" stroke="#94a3b8" stroke-width="1.5" stroke-dasharray="4,2"/>
  <path d="M 730 220 L 500 220 L 500 295" stroke="#94a3b8" stroke-width="1.5" fill="none" stroke-dasharray="4,2" marker-end="url(#arrow)"/>
  <text x="615" y="235" font-family="Arial, sans-serif" font-size="9" fill="#94a3b8">async</text>
  
  <!-- Blocked indicator -->
  <rect x="180" y="200" width="100" height="30" rx="4" fill="#fee2e2" stroke="#ef4444" stroke-width="1"/>
  <text x="230" y="220" font-family="Arial, sans-serif" font-size="9" fill="#b91c1c" text-anchor="middle">Block if needed</text>
  
  <rect x="450" y="200" width="100" height="30" rx="4" fill="#fee2e2" stroke="#ef4444" stroke-width="1"/>
  <text x="500" y="220" font-family="Arial, sans-serif" font-size="9" fill="#b91c1c" text-anchor="middle">Filter if needed</text>
  
  <!-- Assurance layer -->
  <rect x="50" y="300" width="750" height="180" rx="8" fill="#fefce8" stroke="#f59e0b" stroke-width="2"/>
  <text x="75" y="320" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#b45309">ASSURANCE LAYER (Async)</text>
  
  <!-- Judge -->
  <rect x="70" y="340" width="150" height="80" rx="6" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
  <text x="145" y="365" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#b45309" text-anchor="middle">LLM-as-Judge</text>
  <text x="145" y="385" font-family="Arial, sans-serif" font-size="9" fill="#92400e" text-anchor="middle">Evaluates samples</text>
  <text x="145" y="400" font-family="Arial, sans-serif" font-size="9" fill="#92400e" text-anchor="middle">Detects issues</text>
  <text x="145" y="415" font-family="Arial, sans-serif" font-size="9" fill="#92400e" text-anchor="middle">Does NOT block</text>
  
  <line x1="220" y1="380" x2="270" y2="380" stroke="#475569" stroke-width="1.5" marker-end="url(#arrow)"/>
  
  <!-- Finding Router -->
  <rect x="275" y="350" width="120" height="60" rx="6" fill="#fef3c7" stroke="#f59e0b" stroke-width="1.5"/>
  <text x="335" y="375" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#b45309" text-anchor="middle">Finding Router</text>
  <text x="335" y="395" font-family="Arial, sans-serif" font-size="9" fill="#92400e" text-anchor="middle">Prioritises, routes</text>
  
  <line x1="395" y1="380" x2="445" y2="380" stroke="#475569" stroke-width="1.5" marker-end="url(#arrow)"/>
  
  <!-- HITL -->
  <rect x="450" y="340" width="150" height="80" rx="6" fill="#f0fdf4" stroke="#22c55e" stroke-width="3"/>
  <text x="525" y="365" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#166534" text-anchor="middle">Human Review</text>
  <text x="525" y="385" font-family="Arial, sans-serif" font-size="9" fill="#166534" text-anchor="middle">Reviews findings</text>
  <text x="525" y="400" font-family="Arial, sans-serif" font-size="9" fill="#166534" text-anchor="middle">Decides action</text>
  <text x="525" y="415" font-family="Arial, sans-serif" font-size="9" fill="#166534" text-anchor="middle">Accountable</text>
  
  <line x1="600" y1="380" x2="650" y2="380" stroke="#475569" stroke-width="1.5" marker-end="url(#arrow)"/>
  
  <!-- Actions -->
  <rect x="655" y="340" width="130" height="80" rx="6" fill="#f1f5f9" stroke="#94a3b8" stroke-width="1.5"/>
  <text x="720" y="362" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#475569" text-anchor="middle">Actions</text>
  <text x="720" y="382" font-family="Arial, sans-serif" font-size="9" fill="#64748b" text-anchor="middle">• Update guardrails</text>
  <text x="720" y="397" font-family="Arial, sans-serif" font-size="9" fill="#64748b" text-anchor="middle">• Remediate</text>
  <text x="720" y="412" font-family="Arial, sans-serif" font-size="9" fill="#64748b" text-anchor="middle">• Escalate</text>
  
  <!-- Feedback arrow -->
  <path d="M 720 340 L 720 260 L 230 260 L 230 195" stroke="#22c55e" stroke-width="1.5" fill="none" stroke-dasharray="4,2" marker-end="url(#arrow-green)"/>
  <text x="475" y="253" font-family="Arial, sans-serif" font-size="9" fill="#22c55e">feedback: improve guardrails</text>
  
  <!-- Log stream -->
  <rect x="420" y="300" width="120" height="25" rx="4" fill="#f1f5f9" stroke="#94a3b8" stroke-width="1"/>
  <text x="480" y="317" font-family="Arial, sans-serif" font-size="9" fill="#64748b" text-anchor="middle">← from log stream</text>
</svg>
